services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - web
      - api
    restart: always

  api:
    build:
      context: ./kurai-arc-api
      dockerfile: Dockerfile
    # Ports are now internal-only, accessed via Nginx
    # ports:
    #   - "8080:8080"
    env_file:
      - ./kurai-arc-api/.env
    restart: always

  web:
    build:
      context: ./kurai-arc-web
      dockerfile: Dockerfile
    # Ports are now internal-only, accessed via Nginx
    # ports:
    #   - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=/api # Browser now calls /api on the same domain (Nginx routes it)
      - INTERNAL_API_URL=http://api:8080/api
    restart: always
